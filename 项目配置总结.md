# LobeChat é¡¹ç›®é…ç½®æ€»ç»“

## ğŸš€ é¡¹ç›®ç¯å¢ƒé…ç½®

### Docker æœåŠ¡é…ç½®

- PostgreSQL æ•°æ®åº“
- MinIO å¯¹è±¡å­˜å‚¨
- Casdoor è®¤è¯æœåŠ¡
- SearXNG æœç´¢æœåŠ¡

### ç¯å¢ƒå˜é‡é…ç½® (.env)

#### API Keys é…ç½®

```bash
# OpenAI
OPENAI_API_KEY=ä½ çš„å¯†é’¥ï¼ˆæ”¯æŒå¤šä¸ªï¼Œé€—å·åˆ†éš”ï¼‰
OPENAI_MODEL_LIST=gpt-4o,gpt-4o-mini-2024-07-18,o4-mini,gpt-5-chat-latest

# Claude (Anthropic)
ANTHROPIC_API_KEY=ä½ çš„å¯†é’¥
ANTHROPIC_MODEL_LIST=claude-3-haiku-20240307,claude-sonnet-4-20250514,claude-3-7-sonnet-20250219

# Gemini (Google)
GOOGLE_API_KEY=ä½ çš„å¯†é’¥
GOOGLE_MODEL_LIST=gemini-2.5-pro-preview-03-25,gemini-2.5-flash,gemini-2.5-pro

# Grok (xAI)
XAI_API_KEY=ä½ çš„å¯†é’¥
XAI_MODEL_LIST=grok-4-0709
```

#### API Key è½®æ¢æ¨¡å¼

```bash
API_KEY_SELECT_MODE=turn # turn(è½®æµ) æˆ– random(éšæœº)
```

#### ä»£ç†é…ç½®

```bash
# æœ¬æœºå‘½ä»¤è¡Œä»£ç†è®¾ç½®ï¼ˆæ¨èæ–¹å¼ï¼‰
export https_proxy=http://127.0.0.1:7890
export http_proxy=http://127.0.0.1:7890
export all_proxy=socks5://127.0.0.1:7890
```

**é‡è¦è¯´æ˜**ï¼š

- æ‰€æœ‰æ¨¡å‹éƒ½**ä¸éœ€è¦**åœ¨ .env ä¸­é…ç½® PROXY_URL
- åªéœ€åœ¨æœ¬æœºå¯åŠ¨å‘½ä»¤è¡Œä»£ç†å³å¯
- ç³»ç»Ÿä¼šè‡ªåŠ¨é€šè¿‡å‘½ä»¤è¡Œä»£ç†è®¿é—®å„ä¸ª API æœåŠ¡

## ğŸ¯ åŠŸèƒ½å®ç°

### 1. Token ä½¿ç”¨ç»Ÿè®¡ä¸æ‹¦æˆª

**ä½ç½®**: `/src/app/(backend)/webapi/chat/[provider]/route.ts`

- å®ç°äº†æµå¼å“åº”çš„ Token ç»Ÿè®¡
- æ”¯æŒ OpenAI æ ¼å¼çš„ usage äº‹ä»¶
- åœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†çš„ä½¿ç”¨ç»Ÿè®¡
- **æ‹¦æˆªç‚¹**ï¼šå¯åœ¨æ­¤å¤„æ·»åŠ  Token ç”¨é‡æ£€æŸ¥å’Œä¸Šä¼ é€»è¾‘
- **ä¸Šä¼ åŠŸèƒ½**ï¼šé¢„ç•™äº†å‘å¤–éƒ¨æœåŠ¡ä¸Šä¼ ç»Ÿè®¡æ•°æ®çš„æ¥å£

### 2. DALL-E å›¾ç‰‡ç”Ÿæˆé…ç½®

**ä¸»è¦é…ç½®æ–‡ä»¶**: `/src/tools/dalle/index.ts`

ä¿®æ”¹æ–¹æ³•ï¼š

- ä¿®æ”¹ `maxItems` å’Œ `minItems` çš„æ•°é‡ï¼ˆæ§åˆ¶ç”Ÿæˆå›¾ç‰‡æ•°é‡ï¼‰
- ä¿®æ”¹æç¤ºè¯ä¸­çš„æ•°é‡æè¿°ï¼ˆå¦‚ "create four of them" æ”¹ä¸º "create one of them"ï¼‰
- ç³»ç»Ÿæç¤ºè¯ä¸­çš„é™åˆ¶è¯´æ˜ä¹Ÿéœ€è¦åŒæ­¥ä¿®æ”¹

å…¶ä»–ç›¸å…³æ–‡ä»¶ï¼š

- `/src/store/image/slices/generationConfig/initialState.ts` - DEFAULT_IMAGE_NUM
- `/src/server/routers/lambda/image.ts` - å›¾ç‰‡ç”Ÿæˆé€»è¾‘

**é‡è¦**: æ‰€æœ‰æ”¯æŒå›¾ç‰‡ç”Ÿæˆçš„æ¨¡å‹éƒ½å¯ä»¥ä½¿ç”¨ DALL-E 3 çš„æ¨¡å¼è¿›è¡Œç»˜å›¾

### 3. å·¥å…·é…é¢æ§åˆ¶

**å®ç°ä½ç½®**ï¼š

- `/src/services/chat/contextEngineering.ts` - ç³»ç»Ÿè§’è‰²è¿‡æ»¤
- `/src/services/chat/index.ts` - å·¥å…·å‡†å¤‡é˜¶æ®µè¿‡æ»¤
- `/src/store/chat/slices/aiChat/actions/generateAIChat.ts` - ç”Ÿæˆæ—¶è¿‡æ»¤

é…é¢æ§åˆ¶é€»è¾‘å·²é¢„ç•™ï¼Œéœ€å®ç° `getUserImageQuota()` å‡½æ•°ã€‚

### 4. é»˜è®¤æ¨¡å‹é…ç½®

**ä½ç½®**: `/packages/const/src/settings/`

- é»˜è®¤å¯¹è¯æ¨¡å‹: `gemini-2.5-flash`
- é»˜è®¤æä¾›å•†: `google`
- æ ‡é¢˜ç”Ÿæˆä¸“ç”¨: `gemini-2.5-flash`

### 5. API Key ç®¡ç†å™¨æ—¥å¿—

**ä½ç½®**: `/src/server/modules/ModelRuntime/apiKeyManager.ts`

æ·»åŠ äº† API Key é€‰æ‹©æ—¥å¿—ï¼Œæ ¼å¼ï¼š

```
[API Key Manager] Selected key 1/2 (turn mode): sk-proj...xxxx
```

## ğŸ“‹ ç•Œé¢é…ç½®

### "å¤§å®¶éƒ½åœ¨é—®" åŠŸèƒ½

**é…ç½®ä½ç½®**ï¼š

- é—®é¢˜æ–‡æœ¬: `/src/locales/default/welcome.ts`
- æ˜¾ç¤ºé€»è¾‘: `QuestionSuggest.tsx`
- æ˜¾ç¤ºæ•°é‡ï¼šç§»åŠ¨ç«¯ 2 ä¸ªï¼Œæ¡Œé¢ç«¯ 5 ä¸ª
-
- `/src/app/(backend)/` - åç«¯ API è·¯ç”±
- `/src/services/` - æœåŠ¡å±‚ï¼ˆå®¢æˆ·ç«¯ / æœåŠ¡å™¨åŒæ¨¡å¼ï¼‰
- `/src/store/` - Zustand çŠ¶æ€ç®¡ç†
- `/packages/` - Monorepo åŒ…
- `/src/tools/` - å†…ç½®å·¥å…·ç³»ç»Ÿ
